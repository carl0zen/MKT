define(["app"],function(t){return t.module("Entities",function(t){t.FilteredCollection=function(t){var e=t.collection,i=new e.constructor;i.add(e.models),i.filterFunction=t.filterFunction;var n=function(t,n,s){var r,s=s||e;r="filter"==n?t.trim():t;var o=[];if(r)if("filter"==n){if(!i.filterFunction)throw"Attempted to use 'filter' function, but none was defined";var a=i.filterFunction(r);o=s.filter(a)}else o=s.where(r);else o=s.models;return i._currentCriterion=r,o};return i.filter=function(t){i._currentFilter="filter";var e=n(t,"filter");return i.reset(e),i},i.where=function(t){i._currentFilter="where";var e=n(t,"where");return i.reset(e),i},e.on("reset",function(){var t=n(i._currentCriterion,i._currentFilter);i.reset(t)}),e.on("add",function(t){var s=new e.constructor;s.add(t);var r=n(i._currentCriterion,i._currentFilter,s);i.add(r)}),i}}),t.Entities.FilteredCollection});