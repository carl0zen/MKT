define(["app","apps/config/storage/localstorage"],function(t){t.module("Entities",function(t,e,i,n,s,r){t.Contact=i.Model.extend({urlRoot:"contacts",defaults:{firstName:"",lastName:"",phoneNumber:""},validate:function(t){var e={};return t.firstName||(e.firstName="can't be blank"),t.lastName?t.lastName.length<2&&(e.lastName="is too short"):e.lastName="can't be blank",r.isEmpty(e)?void 0:e}}),t.configureStorage(t.Contact),t.ContactCollection=i.Collection.extend({url:"contacts",model:t.Contact,comparator:"firstName"}),t.configureStorage(t.ContactCollection);var o=function(){var e=new t.ContactCollection([{id:1,firstName:"Alice",lastName:"Arten",phoneNumber:"555-0184"},{id:2,firstName:"Bob",lastName:"Brigham",phoneNumber:"555-0163"},{id:3,firstName:"Charlie",lastName:"Campbell",phoneNumber:"555-0129"}]);return e.forEach(function(t){t.save()}),e.models},a={getContactEntities:function(){var e=new t.ContactCollection,i=s.Deferred();e.fetch({success:function(t){i.resolve(t)}});var n=i.promise();return s.when(n).done(function(t){if(0===t.length){var e=o();t.reset(e)}}),n},getContactEntity:function(e){var i=new t.Contact({id:e}),n=s.Deferred();return setTimeout(function(){i.fetch({success:function(t){n.resolve(t)},error:function(){n.resolve(void 0)}})},2e3),n.promise()}};e.reqres.setHandler("contact:entities",function(){return a.getContactEntities()}),e.reqres.setHandler("contact:entity",function(t){return a.getContactEntity(t)}),e.reqres.setHandler("contact:entity:new",function(){return new t.Contact})})});