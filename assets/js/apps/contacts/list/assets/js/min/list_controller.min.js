define(["app","apps/contacts/list/list_view"],function(t,e){return t.module("ContactsApp.List",function(t,i,n,s,r){t.Controller={listContacts:function(t){require(["common/views","entities/contact"],function(n){var s=new n.Loading;i.mainRegion.show(s);var o=i.request("contact:entities"),a=new e.Layout,l=new e.Panel;require(["entities/common"],function(){r.when(o).done(function(n){var s=i.Entities.FilteredCollection({collection:n,filterFunction:function(t){var e=t.toLowerCase();return function(t){return-1!==t.get("firstName").toLowerCase().indexOf(e)||-1!==t.get("lastName").toLowerCase().indexOf(e)||-1!==t.get("phoneNumber").toLowerCase().indexOf(e)?t:void 0}}});t&&(s.filter(t),l.once("show",function(){l.triggerMethod("set:filter:criterion",t)}));var r=new e.Contacts({collection:s});l.on("contacts:filter",function(t){s.filter(t),i.trigger("contacts:filter",t)}),a.on("show",function(){a.panelRegion.show(l),a.contactsRegion.show(r)}),l.on("contact:new",function(){require(["apps/contacts/new/new_view"],function(t){var e=i.request("contact:entity:new"),s=new t.Contact({model:e});s.on("form:submit",function(t){if(n.length>0){var i=n.max(function(t){return t.id}).get("id");t.id=i+1}else t.id=1;if(e.save(t)){n.add(e),s.trigger("dialog:close");var o=r.children.findByModel(e);o&&o.flash("success")}else s.triggerMethod("form:data:invalid",e.validationError)}),i.dialogRegion.show(s)})}),r.on("itemview:contact:show",function(t,e){i.trigger("contact:show",e.get("id"))}),r.on("itemview:contact:edit",function(t,e){require(["apps/contacts/edit/edit_view"],function(n){var s=new n.Contact({model:e});s.on("form:submit",function(i){e.save(i)?(t.render(),s.trigger("dialog:close"),t.flash("success")):s.triggerMethod("form:data:invalid",e.validationError)}),i.dialogRegion.show(s)})}),r.on("itemview:contact:delete",function(t,e){e.destroy()}),i.mainRegion.show(a)})})})}}}),t.ContactsApp.List.Controller});