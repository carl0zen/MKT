Backbone.Syphon=function(t,e,i){var n={};n.ignoredTypes=["button","submit","reset","fieldset"],n.serialize=function(t,n){var o={},c=a(n),u=s(t,c);return i.each(u,function(t){var i=e(t),n=r(i),s=c.keyExtractors.get(n),a=s(i),u=c.inputReaders.get(n),h=u(i),d=c.keyAssignmentValidators.get(n);if(d(i,a,h)){var p=c.keySplitter(a);o=l(o,p,h)}}),o},n.deserialize=function(t,n,o){var l=a(o),u=s(t,l),h=c(l,n);i.each(u,function(t){var i=e(t),n=r(i),s=l.keyExtractors.get(n),o=s(i),a=l.inputWriters.get(n),c=h[o];a(i,c)})};var s=function(t,n){var s=o(t),a=s.elements;return a=i.reject(a,function(t){var s,o=r(t),a=n.keyExtractors.get(o),l=a(e(t)),c=i.include(n.ignoredTypes,o),u=i.include(n.include,l),h=i.include(n.exclude,l);return s=u?!1:n.include?!0:h||c})},r=function(t){var i,n=e(t),s=n[0].tagName,r=s;return"input"===s.toLowerCase()&&(i=n.attr("type"),r=i?i:"text"),r.toLowerCase()},o=function(t){return i.isUndefined(t.$el)&&"form"===t.tagName.toLowerCase()?t:t.$el.is("form")?t.el:t.$("form")[0]},a=function(t){var e=i.clone(t)||{};return e.ignoredTypes=i.clone(n.ignoredTypes),e.inputReaders=e.inputReaders||n.InputReaders,e.inputWriters=e.inputWriters||n.InputWriters,e.keyExtractors=e.keyExtractors||n.KeyExtractors,e.keySplitter=e.keySplitter||n.KeySplitter,e.keyJoiner=e.keyJoiner||n.KeyJoiner,e.keyAssignmentValidators=e.keyAssignmentValidators||n.KeyAssignmentValidators,e},l=function(t,e,n){if(!e)return t;var s=e.shift();return t[s]||(t[s]=i.isArray(s)?[]:{}),0===e.length&&(i.isArray(t[s])?t[s].push(n):t[s]=n),e.length>0&&l(t[s],e,n),t},c=function(t,e,n){var s={};return i.each(e,function(e,r){var o={};n&&(r=t.keyJoiner(n,r)),i.isArray(e)?(r+="[]",o[r]=e):i.isObject(e)?o=c(t,e,r):o[r]=e,i.extend(s,o)}),s};return n}(Backbone,jQuery,_),Backbone.Syphon.TypeRegistry=function(){this.registeredTypes={}},Backbone.Syphon.TypeRegistry.extend=Backbone.Model.extend,_.extend(Backbone.Syphon.TypeRegistry.prototype,{get:function(t){var e=this.registeredTypes[t];return e||(e=this.registeredTypes["default"]),e},register:function(t,e){this.registeredTypes[t]=e},registerDefault:function(t){this.registeredTypes["default"]=t},unregister:function(t){this.registeredTypes[t]&&delete this.registeredTypes[t]}}),Backbone.Syphon.KeyExtractorSet=Backbone.Syphon.TypeRegistry.extend(),Backbone.Syphon.KeyExtractors=new Backbone.Syphon.KeyExtractorSet,Backbone.Syphon.KeyExtractors.registerDefault(function(t){return t.prop("name")}),Backbone.Syphon.InputReaderSet=Backbone.Syphon.TypeRegistry.extend(),Backbone.Syphon.InputReaders=new Backbone.Syphon.InputReaderSet,Backbone.Syphon.InputReaders.registerDefault(function(t){return t.val()}),Backbone.Syphon.InputReaders.register("checkbox",function(t){var e=t.prop("checked");return e}),Backbone.Syphon.InputWriterSet=Backbone.Syphon.TypeRegistry.extend(),Backbone.Syphon.InputWriters=new Backbone.Syphon.InputWriterSet,Backbone.Syphon.InputWriters.registerDefault(function(t,e){t.val(e)}),Backbone.Syphon.InputWriters.register("checkbox",function(t,e){t.prop("checked",e)}),Backbone.Syphon.InputWriters.register("radio",function(t,e){t.prop("checked",t.val()===e)}),Backbone.Syphon.KeyAssignmentValidatorSet=Backbone.Syphon.TypeRegistry.extend(),Backbone.Syphon.KeyAssignmentValidators=new Backbone.Syphon.KeyAssignmentValidatorSet,Backbone.Syphon.KeyAssignmentValidators.registerDefault(function(){return!0}),Backbone.Syphon.KeyAssignmentValidators.register("radio",function(t){return t.prop("checked")}),Backbone.Syphon.KeySplitter=function(t){var e=t.match(/[^\[\]]+/g);return t.indexOf("[]")===t.length-2&&(lastKey=e.pop(),e.push([lastKey])),e},Backbone.Syphon.KeyJoiner=function(t,e){return t+"["+e+"]"};